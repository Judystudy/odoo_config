webpackJsonp([1],{FghN:function(e,t){},Mwd1:function(e,t){},NHnr:function(e,t,n){"use strict";function i(e){n("xk8O")}function o(e){n("FghN")}function a(e){return{id:0,value:e||"",component:"text-input",record:{}}}function s(){H(window).on("resize",function(){H(this.$el).closest(".oe_notebook_page").css({top:H("#oe_main_menu_navbar").height(),height:H(window).height()-H("#oe_main_menu_navbar").height()})});var e=document.getElementById("items");S.a.create(e,{ghostClass:"ghost",animation:150,onUpdate:function(e){var t=H(e.item),n=parseInt(t.attr("data-index")),i=t.prev().length>0?parseInt(t.prev().attr("data-index"))+1:0,o=U.items[n];U.items.$remove(o),p.a.nextTick(function(){i<n?U.items.splice(i,0,o):i>n&&U.items.splice(i-1,0,o)})}})}function r(e){return{id:0,value:"",component:"image-input",file:e,record:{}}}function c(e){return{id:0,record:{value:e.value||"",model_id:0,model:e.model,domain:e.domain,name:e.name,placeholder:e.placeholder},component:"many2one-input"}}function d(e){var t=H('.editor-item[data-index="'+e+'"]').next();t.length>0&&(t.find("textarea, input").length>0?t.find("textarea, input").focus():d(e+1))}function l(e){var t=H('li[data-index="'+e+'"]').prev();t.length>0&&(t.find("textarea, input").length>0?t.find("textarea, input").focus():l(e-1))}function u(e){n("Mwd1")}Object.defineProperty(t,"__esModule",{value:!0});var p=n("7+uW"),_=n("mvHQ"),h=n.n(_),v={props:["model","index"],methods:{enter_input:function(e){if(e.shiftKey){e.preventDefault();(new p.a).$emit("add-text",this.index)}},next_textarea:function(e){if(e.shiftKey){e.preventDefault();(new p.a).$emit("next-textarea",this.index)}},prev_textarea:function(e){if(e.shiftKey){e.preventDefault();(new p.a).$emit("prev-textarea",this.index)}},input_change:function(e){(new p.a).$emit("text-input-change",this.index)}}},m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-input"},[n("div",{staticClass:"expandingArea "},[n("pre",[n("span",[e._v(e._s(e.model.value))]),n("br")]),e._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.model.value,expression:"model.value"}],attrs:{placeholder:"输入描述内容"},domProps:{value:e.model.value},on:{input:[function(t){t.target.composing||e.$set(e.model,"value",t.target.value)},function(t){t.preventDefault(),e.input_change(t)}],keydown:[function(t){if(!("button"in t)&&e._k(t.keyCode,"down",40,t.key))return null;e.next_textarea(t)},function(t){if(!("button"in t)&&e._k(t.keyCode,"up",38,t.key))return null;e.prev_textarea(t)},function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.enter_input(t)}]}})])])},f=[],g={render:m,staticRenderFns:f},x=g,y=n("VU/8"),w=i,k=y(v,x,!1,w,null,null),C=k.exports,D={props:["model"],data:function(){return{loaded:!1,imageWidth:250,imageHeight:200,mask_height:0}},mounted:function(){if(!this.model.value){if(console.log(this.model),["image/png","image/jpeg","image/gif"].indexOf(this.model.file.type)<0)return;var e=this,t=new FileReader;t.onload=function(t){e.model.value=t.target.result},t.readAsDataURL(this.model.file)}},events:{preview_picture:function(e){this.imageWidth=e?50:250}},methods:{load:function(e){this.loaded=!0}}},b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-input"},[n("img",{staticStyle:{width:"250px",height:"250px"},attrs:{src:e.model.value},on:{load:e.load}}),e._v(" "),e.loaded?e._e():n("div",{staticClass:"image-input-mask-container"},[n("span",{staticClass:"image-input-mask"})])])},T=[],$={render:b,staticRenderFns:T},N=$,F=n("VU/8"),P=o,R=F(D,N,!1,P,null,null),E=R.exports,O=n("Lokx"),S=n.n(O),H=n("7t+N"),U={loading_index:0,items:[{value:"",component:"text-input",record:{}}],operators:[{method:"plus",operator_icon:"operator_icon_plus"},{method:"delete",operator_icon:"operator_icon_delete"}],is_display_many2one_choose:!1,display_operator_choose:-1,dragging:!1,choose_index:-1,loading:!1,delete_items:[],is_display_device:!0,is_fullscreen:!1,original_height:0,is_preview:!1,is_save:!1},J={props:["config"],name:"editor",mounted:function(){s.bind(this)(),this.get()},data:function(){return U},events:{"add-text":function(e){this.items.splice(e+1,0,a("")),p.a.nextTick(function(){d(e)})},"next-textarea":d,"prev-textarea":l,"text-input-change":function(){this.is_save=!1,(new p.a).$emit("text-input-change")}},components:{Sortable:S.a,"text-input":C,"image-input":E},computed:{many2one_choose:function(){return this.config.many2one||[]}},methods:{choose_leave:function(){this.is_display_many2one_choose&&(this.is_display_many2one_choose=!1)},choose_over:function(){this.is_display_many2one_choose||(this.is_display_many2one_choose=!0)},picture_preview:function(){this.is_preview=!this.is_preview,(new p.a).$emit("preview_picture",this.is_preview)},fullscreen:function(){var e=H(this.$el).closest(".oe_notebook_page");this.is_fullscreen?e.height(this.original_height):(this.original_height=e.height(),e.css({top:H("#oe_main_menu_navbar").height(),height:H(window).height()-H("#oe_main_menu_navbar").height()})),this.is_fullscreen=!this.is_fullscreen,e.toggleClass("editor-fullscreen"),H(".oe_chatter").toggle()},display_device:function(){this.is_display_device=!this.is_display_device},get:function(){var e=this,t=e.config.getFunc||function(){return H.when(H.post(e.config.get_url||"/editor/get",{editor_id:e.config.osv.editor_id,osv_info:h()(e.config.osv)}))},n=e.config.getDone||function(t){t=JSON.parse(t),t.forEach(function(e){"many2one-input"===e.component&&(e.record=JSON.parse(e.value))}),e.items=t,e.loading=!1};this.loading_more(t).then(n)},do_many2one_choose:function(e){var t=this;t.is_display_many2one_choose=!1,t.items.push(c(e)),p.a.nextTick(function(){d(t.items.length-2)})},newRecord:function(){var e=this;e.is_display_many2one_choose=!1,e.items.push(a()),p.a.nextTick(function(){d(e.items.length-2)})},save:function(){var e=this,t=this.config.saveFunc||function(){var t=new FormData;t.append("osv_info",h()(this.config.osv)),t.append("editor_id",this.config.osv.editor_id),t.append("delete_items",h()(this.delete_items));for(var n in e.items){var i=e.items[n];"image-input"===i.component?(t.append(n,i.file||""),t.append(n+"-id",h()({id:i.id}))):"text-input"===i.component?t.append(n,h()({id:i.id,value:i.value,component:i.component})):"many2one-input"===i.component&&t.append(n,h()({id:i.id,value:h()(i.record),component:i.component}))}var o=new XMLHttpRequest;o.open("post",this.config.save_url||"/editor/save"),o.onreadystatechange=function(t){if(4===o.readyState&&200===o.status){e.loading=!1;var n=JSON.parse(o.responseText);H.isArray(n)&&n.forEach(function(t){e.items[t[0]].id=t[1]}),e.is_save=!0,e.delete_items=[]}},o.onerror=function(e){alert("发生了一些错误，请联系管理员")},o.send(t)};this.loading_more(t)},loading_more:function(e,t){function n(){i.loading_index=++i.loading_index%100,i.loading?setTimeout(n,30):i.loading_index=0}var i=this;return!!i.loading||(!(!t||!t.apply(i))||(i.loading=!0,i.loading_index=0,n(),e.apply(i)))},leave_operator:function(){this.display_operator_choose=-1},move_operator:function(e,t,n){"plus"===e&&(this.display_operator_choose=n)},do_operator_many2one_choose:function(e,t,n,i){var o=this;o.display_operator_choose=-1,o.items.splice(n+1,0,i?a(""):c(e)),p.a.nextTick(function(){d(n)})},do_operator:function(e,t,n){"plus"===e?0===this.many2one_choose.length&&(this.items.splice(n+1,0,a()),p.a.nextTick(function(){d(n)})):"delete"===e&&(this.items[n].id>0&&this.delete_items.push(this.items[n].id),this.items.splice(n,1))},click_item:function(e){this.choose_index=this.choose_index===e?-1:e},dragover:function(){},dragend:function(){this.dragging=!1},drop:function(e){this.dragging=!1;for(var t=0;t<e.dataTransfer.files.length;t++)this.preview_file(e.dataTransfer.files[t])},preview_file:function(e){this.items.push(r(e))},dragenter:function(){this.dragging=!0},dragleave:function(){this.dragging=!1}},watch:{items:function(e){e.length<=0&&(this.items=[{value:"",component:"text-input"}]),this.is_save=!1}}},M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"vux-editor"}},[n("div",{staticClass:"editor-loading"},[n("div",{staticClass:"editor-loading-layer",style:{width:e.loading_index+"%"}})]),e._v(" "),n("div",{staticClass:"editor-button"},[n("a",{staticClass:"editor-button-save",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.save(t)}}},[e._v(e._s(e.is_save?"保存成功":"保存编辑器"))]),e._v(" "),0===e.many2one_choose.length?n("a",{staticClass:"editor-button-new",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.newRecord(t)}}},[e._v("添加描述信息")]):e._e(),e._v(" "),e.many2one_choose.length>0?n("div",{staticClass:"many2one-choose",on:{mouseleave:e.choose_leave,mouseover:e.choose_over}},[n("a",{staticClass:"editor-button-new"},[e._v("添加内容")]),e._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:e.is_display_many2one_choose,expression:"is_display_many2one_choose"}],staticClass:"many2one-choose-list",attrs:{transition:"expand"}},[e._l(e.many2one_choose,function(t){return n("li",{on:{click:function(n){if(n.preventDefault(),n.target!==n.currentTarget)return null;e.do_many2one_choose(t)}}},[e._v(e._s(t.string))])}),e._v(" "),n("li",{on:{click:function(t){if(t.preventDefault(),t.target!==t.currentTarget)return null;e.newRecord(t)}}},[e._v("添加描述信息")])],2)]):e._e(),e._v(" "),n("a",{staticClass:"editor-button-hidden",on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.display_device(t)}}},[e._v(e._s(e.is_display_device?"关闭预览":"打开预览"))])]),e._v(" "),n("div",{staticClass:"dftg-editor",class:{dragging:e.dragging},on:{dragover:function(t){t.preventDefault(),e.dragover(t)},dragend:function(t){t.preventDefault(),e.dragend(t)},drop:function(t){t.preventDefault(),e.drop(t)},dragenter:function(t){t.preventDefault(),t.stopPropagation(),e.dragenter(t)},dragleave:function(t){if(t.preventDefault(),t.stopPropagation(),t.target!==t.currentTarget)return null;e.dragleave(t)}}},[n("ul",{attrs:{id:"items"}},e._l(e.items,function(t,i){return n("li",{staticClass:"editor-item",class:{choosed:i==e.choose_index},attrs:{"data-index":i},on:{click:function(t){e.click_item(i)}}},[n(t.component,{tag:"component",attrs:{config:e.config,model:t,index:i},on:{"update:model":function(e){t=e}}}),e._v(" "),n("ul",{staticClass:"operator-set",on:{mouseleave:e.leave_operator}},[e._l(e.operators,function(o,a){return n("li",{staticClass:"operator_icon",class:o.operator_icon,on:{click:function(n){n.preventDefault(),n.stopPropagation(),e.do_operator(o.method,t,i)},mouseover:function(n){if(n.preventDefault(),n.stopPropagation(),n.target!==n.currentTarget)return null;e.move_operator(o.method,t,i)}}})}),e._v(" "),e.many2one_choose.length>0?n("ul",{directives:[{name:"show",rawName:"v-show",value:e.display_operator_choose===i,expression:"display_operator_choose === item_index"}],staticClass:"many2one-operator-choose-list",attrs:{transition:"expand"}},[e._l(e.many2one_choose,function(o){return n("li",{on:{click:function(n){if(n.preventDefault(),n.target!==n.currentTarget)return null;e.do_operator_many2one_choose(o,t,i)}}},[e._v(e._s(o.string))])}),e._v(" "),n("li",{on:{click:function(n){if(n.preventDefault(),n.target!==n.currentTarget)return null;e.do_operator_many2one_choose(e.many2one,t,i,"text")}}},[e._v("添加描述信息")])],2):e._e()],2)],1)})),e._v(" "),n("div",{staticClass:"editor-comment",class:[e.items.length>1||"image-input"===e.items[0].component?"editor-comment-hide":""]},[n("p",[e._v("直接在图片拖放到这里就可以自动上传图片")]),e._v(" "),n("p",[e._v("使用shift + 回车键直接创建一个新的行")]),e._v(" "),n("p",[e._v("使用shift + 上/下 在不同行直接来回切换")]),e._v(" "),n("p",[e._v("使用右边的保存编辑器按钮来保存所有编辑的描述")])])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.is_display_device,expression:"is_display_device"}],staticClass:"editor-device"},[n("div",{staticClass:"editor-content"},[e._l(e.items,function(t){return["text-input"===t.component?n("div",[e._v(e._s(t.value))]):e._e(),e._v(" "),"image-input"===t.component?n("img",{attrs:{src:t.value}}):e._e()]})],2)])])},V=[],A={render:M,staticRenderFns:V},I=A,K=n("VU/8"),L=u,W=K(J,I,!1,L,null,null),j=W.exports;new p.a({el:"#product-editor",components:{Editor:j}}),p.a.config.devtools=!0,p.a.component("editor",j),window.Vue=p.a},xk8O:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.js.map